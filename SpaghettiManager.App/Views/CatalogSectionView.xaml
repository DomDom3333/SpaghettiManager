<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="SpaghettiManager.App.Views.CatalogSectionView"
    x:DataType="viewModels:CatalogSectionViewModel"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:modelRecords="clr-namespace:SpaghettiManager.Model.Records;assembly=SpaghettiManager.Model"
    xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
    xmlns:viewModels="clr-namespace:SpaghettiManager.App.ViewModels"
    xmlns:views="clr-namespace:SpaghettiManager.App.Views"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <ContentView.Resources>
        <DataTemplate x:DataType="modelRecords:Manufacturer" x:Key="ManufacturerTemplate">
            <Frame Margin="0,4" Padding="12">
                <VerticalStackLayout Spacing="4">
                    <Label FontAttributes="Bold" Text="{Binding Name}" />
                    <Label FontSize="12" Text="{Binding Country}" />
                    <Label FontSize="12" Text="{Binding Website}" />
                </VerticalStackLayout>
            </Frame>
        </DataTemplate>
        <DataTemplate x:DataType="modelRecords:Material" x:Key="MaterialTemplate">
            <Frame Margin="0,4" Padding="12">
                <VerticalStackLayout Spacing="6">
                    <Label FontAttributes="Bold" Text="{Binding Name}" />
                    <HorizontalStackLayout Spacing="8">
                        <Label FontSize="12" Text="{Binding Family}" />
                        <Label FontSize="12" Text="{Binding AdditiveMaterial}" />
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Spacing="8">
                        <Label FontSize="12" Text="{Binding Manufacturer}" />
                        <Label FontSize="12" Text="{Binding DiameterMm, StringFormat='{0} mm'}" />
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Spacing="8">
                        <BoxView
                            Color="{Binding Color}"
                            HeightRequest="12"
                            WidthRequest="12" />
                        <Label FontSize="12" Text="{Binding Finish}" />
                        <Label FontSize="12" Text="{Binding Opacity}" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>
        </DataTemplate>
        <DataTemplate x:DataType="modelRecords:Carrier" x:Key="CarrierTemplate">
            <Frame Margin="0,4" Padding="12">
                <VerticalStackLayout Spacing="4">
                    <Label FontAttributes="Bold" Text="{Binding Manufacturer}" />
                    <Label FontSize="12" Text="{Binding SpoolType}" />
                    <Label FontSize="12" Text="{Binding EmptyWeightGrams, StringFormat='Empty: {0} g'}" />
                </VerticalStackLayout>
            </Frame>
        </DataTemplate>
        <views:CatalogItemTemplateSelector
            CarrierTemplate="{StaticResource CarrierTemplate}"
            ManufacturerTemplate="{StaticResource ManufacturerTemplate}"
            MaterialTemplate="{StaticResource MaterialTemplate}"
            x:Key="CatalogItemTemplateSelector" />
    </ContentView.Resources>

    <Grid Padding="16" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Label
            FontAttributes="Bold"
            Grid.Row="0"
            Text="{Binding SectionTitle}" />

        <Label
            FontSize="12"
            Grid.Row="1"
            Text="{Binding SectionSummary}"
            TextColor="{DynamicResource SecondaryTextColor}" />

        <SearchBar
            Grid.Row="2"
            IsVisible="{Binding SupportsSearch}"
            Placeholder="Search catalog"
            Text="{Binding SearchQuery}" />

        <CollectionView
            Grid.Row="3"
            ItemTemplate="{StaticResource CatalogItemTemplateSelector}"
            ItemsSource="{Binding Items}"
            RemainingItemsThreshold="5"
            RemainingItemsThresholdReachedCommand="{Binding LoadMoreCommand}">
            <CollectionView.EmptyView>
                <Label
                    FontSize="12"
                    HorizontalOptions="Center"
                    Text="{Binding EmptyStateMessage}"
                    TextColor="{DynamicResource SecondaryTextColor}" />
            </CollectionView.EmptyView>
        </CollectionView>

        <ActivityIndicator
            Grid.Row="4"
            HorizontalOptions="Center"
            IsRunning="{Binding IsLoadingMore}"
            IsVisible="{Binding IsLoadingMore}" />
    </Grid>
</ContentView>
